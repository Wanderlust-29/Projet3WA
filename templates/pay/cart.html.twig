{% extends "layout.html.twig" %}

{% block title %}
	Panier
	{{ parent() }}
{% endblock %}

{% block head %}
	<script src="https://js.stripe.com/v3/"></script>
{% endblock %}

{% block main %}
	<main id="content" class="cart">
		<section class="cart-payement">
			<h1>Mon panier
				{% if cart is empty %}est vide...
				{% endif %}
			</h1>
			{% if cart is empty %}
				<p>Vous souhaitez passer Ã  la caisse sans croquettes, jouets ou mastication pour vos amis Ã  4 pattes ? ðŸ˜­ðŸ˜­ðŸ˜­</p>
				<p>
					<a class="btn btn-cart-back" href="/">Revenir Ã  la boutique</a>
				</p>
			{% else %}
				<ul class="list-articles">
					{% for article in cart %}
						<article class="article">
							<a href="/article/{{ article.slug }}">
								<img src="{{ article.image.getUrl() }}" alt="{{ article.image.getAlt() }}"/>

								<h2 class="article-name"></h2>
								{{ article.name }}</a>
							<span class="increment-decrement-btns" data-article="{{ article.id }}">
								<button class="btn-increment" data-article="{{ article.id }}" data-action="increment" {% if not article.is_in_stock %} disabled {% endif %}>+</button>
								<span class="quantity" data-article="{{ article.id }}">{{ article.quantity }}</span>
								<button class="btn-decrement" data-article="{{ article.id }}" data-action="decrement">-</button>
							</span>
						</article>
					{% endfor %}
				</li>
			</ul>

			<form action="" method="POST" class="update-shipping-costs" id="shippingForm">
				<legend>Frais de port</legend>
				{% for cost in shipping_costs %}
					<fieldset>
						<input type="radio" id="{{ cost.name }}" name="drone" value="{{ cost.id }}" required/>
						<label for="{{ cost.name }}">{{ cost.description }}
							(
							{% if cost.price == 0 %}Gratuit
							{% else %}
								{{ cost.price }}â‚¬
							{% endif %})</label>
					</fieldset>
				{% endfor %}
			</form>

			<form class="form-checkout" action="stripe/checkout.php" method="POST">
				<label id="cart-total-price">
					Total :
					<span class="total-price">{{ totalPrice|number_format(2, '.', ',') }}
						â‚¬</span>
				</label>
				<input type="hidden" name="totalPrice" value="{{totalPrice}}">

				<a class="btn-cart-back" href="/">Continuer mes achats</a>

				{% if session is defined and session is not null %}
					{% if cart != [] %}
						<input type="submit" id="checkout-button" value='Valider et payer'/>
					{% endif %}
				{% else %}
					{% if cart != [] %}
						<a class="btn-login" href="/login">Connectez-vous pour payer</a>
					{% endif %}
				{% endif %}
			</form>
		{% endif %}
	</section>
</main>{% endblock %}{% block javascript %}
<script src="assets/js/error-success.js" defer></script>{% endblock %}
