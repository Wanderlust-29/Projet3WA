{% extends "layout.html.twig" %}

{% block title %}
	Mon compte
	{{ parent() }}
{% endblock %}

{% block head %}{% endblock %}

{% block main %}
	<main id="content" class="account">
		{% if session is defined and session is not null %}

			<h1>Bienvenue
				{{ session.firstName }}
				{{ session.lastName }}
				!</h1>

			<section
				class="form-account">
				{# Formulaire pour modifier les données de l'utilisateur #}
				<h2>Modifier mes coordonnées</h2>
				<form action="/update" method="post" class="update">
					<fieldset>
						<label for="firstName">
							Prénom
						</label>
						<input type="text" name="firstName" id="firstName" value="{{ session.firstName }}"/>
					</fieldset>
					<fieldset>
						<label for="lastName">
							Nom
						</label>
						<input type="text" name="lastName" id="lastName" value="{{ session.lastName }}"/>
					</fieldset>
					<fieldset>
						<label for="email">
							E-mail
						</label>
						<input type="email" name="email" id="email" value="{{ session.email }}"/>
					</fieldset>
					<fieldset>
						<label for="password">
							mot de passe
						</label>
						<input type="password" name="password" id="password" placeholder="nouveau mot de passe"/>
					</fieldset>
					<fieldset>
						<label for="confirm-password">
							Confirmer le mot de passe
						</label>
						<input type="password" name="confirm-password" id="confirm-password" placeholder="confirmer le nouveau mot de passe"/>
					</fieldset>
					<fieldset>
						<label for="address">
							Adresse
						</label>
						<input type="text" name="address" id="address" value="{{ session.address }}"/>
					</fieldset>
					<fieldset>
						<label for="city">
							Ville
						</label>
						<input type="text" name="city" id="city" value="{{ session.city }}"/>
					</fieldset>
					<fieldset>
						<label for="postalCode">
							Code postal
						</label>
						<input type="number" name="postalCode" id="postalCode" value="{{ session.postalCode }}"/>
					</fieldset>
					<fieldset>
						<label for="country">
							Pays
						</label>
						<input type="text" name="country" id="country" value="{{ session.country }}"/>
					</fieldset>

					<button type="submit" name="update">Modifier</button>
				</form>
			</section>

			{# toutes les commandes de l'utilisateur #}
			<section class="container-orders">
				<h2>Toutes mes commandes</h2>
				<ul class="my-orders">
					{% if orders is not empty %}
						{% for order in orders %}
							<li class="order">
								<p>Date de la commande:
									{{ order.createdAt }}
									<br>
									Total:
									{{ order.totalPrice }}€</p>
								<a class="modal-detail">
									<i class="fa-regular fa-file-lines"></i>
									Détail de la commande
								</a>
								<ul class="order-articles">

									<li class="order-status">Statut du colis:
										{{ order.status }}<br>Commande n°{{ order.id }}
										<a class="btn-close-modal">
											<i class="fa-solid fa-xmark"></i>
										</a>
									</li>
									{% set orderArticles = ordersArticles[order.id] %}
									{% if orderArticles is not empty %}
										{% for article in orderArticles %}
											<li class="article-detail">
												<a class="detail-article" href="/article/{{ article.slug }}">
													<figure>
														<img src="{{ article.image.getUrl() }}" alt="{{ article.image.getAlt() }}"/>
													</figure>
													<p class="article-name">{{ article.name }}</p>
													<p class="article-name">(X
														{{ article.quantity }})</p>
												</a>
												<a class="comment" href="/new-comment/{{ article.slug}}">
													<i class="fa-solid fa-message"></i>
													Laisser un commentaire
												</a>
											</li>
										{% endfor %}
									{% else %}
										<li>Aucun article trouvé pour cette commande.</li>
									{% endif %}
								</ul>
							</li>
						{% endfor %}
					{% else %}
						<li>Aucune commande trouvée.</li>
					{% endif %}
				</ul>
			</section>

			<aside class="account-management">
				<form action="/delete" method="post" class="other-btns">
					<input type="hidden" name="userId" value="{{ session.id }}"/>
					<button type="submit" name="delete">Supprimer</button>
				</form>

				<form action="/logout" method="post" class="other-btns">
					<button type="submit" name="logout">Se déconnecter</button>
				</form>
			</aside>


		{% else %}
			<h1>Pour continuer, vous devez être connecté</h1>
			<a class="btn-login" href="/login">Se connecter</a>
			<a class="btn-register" href="/register">S'inscrire</a>
		{% endif %}
	</main>
{% endblock %}
{% block javascript %}
	<script src="assets/js/account.js"></script>
{% endblock %}
